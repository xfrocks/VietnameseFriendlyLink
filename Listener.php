<?php

namespace Xfrocks\VietnameseFriendlyLink;

use XF\Container;
use XF\Mvc\Router;

class Listener
{
    /**
     * @param Container $container
     * @param Router $router
     * @see \XF\Mvc\Router::prepareStringForUrl()
     * @see utf8_deaccent
     * @see utf8_romanize
     */
    public static function routerPublicSetup($container, &$router)
    {
        if (!self::$doneIt) {
            self::doIt();
            self::$doneIt = true;
        }

        $router->setRomanizeUrls(true);
    }

    private static $doneIt = false;

    private static function doIt()
    {
        global $UTF8_LOWER_ACCENTS, $UTF8_UPPER_ACCENTS, $UTF8_ROMANIZATION;

        $UTF8_LOWER_ACCENTS += [
            'Ã ' => 'a',
            'Ã¡' => 'a',
            'áº¡' => 'a',
            'áº£' => 'a',
            'Ã£' => 'a',
            'Ã¢' => 'a',
            'áº§' => 'a',
            'áº¥' => 'a',
            'áº­' => 'a',
            'áº©' => 'a',
            'áº«' => 'a',
            'Äƒ' => 'a',
            'áº±' => 'a',
            'áº¯' => 'a',
            'áº·' => 'a',
            'áº³' => 'a',
            'áºµ' => 'a',
            'Ã¨' => 'e',
            'Ã©' => 'e',
            'áº¹' => 'e',
            'áº»' => 'e',
            'áº½' => 'e',
            'Ãª' => 'e',
            'á»' => 'e',
            'áº¿' => 'e',
            'á»‡' => 'e',
            'á»ƒ' => 'e',
            'á»…' => 'e',
            'Ã¬' => 'i',
            'Ã­' => 'i',
            'á»‹' => 'i',
            'á»‰' => 'i',
            'Ä©' => 'i',
            'Ã²' => 'o',
            'Ã³' => 'o',
            'á»' => 'o',
            'á»' => 'o',
            'Ãµ' => 'o',
            'Ã´' => 'o',
            'á»“' => 'o',
            'á»‘' => 'o',
            'á»™' => 'o',
            'á»•' => 'o',
            'á»—' => 'o',
            'Æ¡' => 'o',
            'á»' => 'o',
            'á»›' => 'o',
            'á»£' => 'o',
            'á»Ÿ' => 'o',
            'á»¡' => 'o',
            'Ã¹' => 'u',
            'Ãº' => 'u',
            'á»¥' => 'u',
            'á»§' => 'u',
            'Å©' => 'u',
            'Æ°' => 'u',
            'á»«' => 'u',
            'á»©' => 'u',
            'á»±' => 'u',
            'á»­' => 'u',
            'á»¯' => 'u',
            'á»³' => 'y',
            'Ã½' => 'y',
            'á»µ' => 'y',
            'á»·' => 'y',
            'á»¹' => 'y',
            'Ä‘' => 'd',
        ];

        $UTF8_UPPER_ACCENTS += [
            'Ã€' => 'A',
            'Ã' => 'A',
            'áº ' => 'A',
            'áº¢' => 'A',
            'Ãƒ' => 'A',
            'Ã‚' => 'A',
            'áº¦' => 'A',
            'áº¤' => 'A',
            'áº¬' => 'A',
            'áº¨' => 'A',
            'áºª' => 'A',
            'Ä‚' => 'A',
            'áº°' => 'A',
            'áº®' => 'A',
            'áº¶' => 'A',
            'áº²' => 'A',
            'áº´' => 'A',
            'Ãˆ' => 'E',
            'Ã‰' => 'E',
            'áº¸' => 'E',
            'áºº' => 'E',
            'áº¼' => 'E',
            'ÃŠ' => 'E',
            'á»€' => 'E',
            'áº¾' => 'E',
            'á»†' => 'E',
            'á»‚' => 'E',
            'á»„' => 'E',
            'ÃŒ' => 'I',
            'Ã' => 'I',
            'á»Š' => 'I',
            'á»ˆ' => 'I',
            'Ä¨' => 'I',
            'Ã’' => 'O',
            'Ã“' => 'O',
            'á»Œ' => 'O',
            'á»' => 'O',
            'Ã•' => 'O',
            'Ã”' => 'O',
            'á»’' => 'O',
            'á»' => 'O',
            'á»˜' => 'O',
            'á»”' => 'O',
            'á»–' => 'O',
            'Æ ' => 'O',
            'á»œ' => 'O',
            'á»š' => 'O',
            'á»¢' => 'O',
            'á»' => 'O',
            'á» ' => 'O',
            'Ã™' => 'U',
            'Ãš' => 'U',
            'á»¤' => 'U',
            'á»¦' => 'U',
            'Å¨' => 'U',
            'Æ¯' => 'U',
            'á»ª' => 'U',
            'á»¨' => 'U',
            'á»°' => 'U',
            'á»¬' => 'U',
            'á»®' => 'U',
            'á»²' => 'Y',
            'Ã' => 'Y',
            'á»´' => 'Y',
            'á»¶' => 'Y',
            'á»¸' => 'Y',
            'Ä' => 'D',
        ];

        $UTF8_ROMANIZATION += [
            'Ì‰' => '',
            'Ì£' => '',
            'Ìƒ' => '',
            'Ì€' => '',
            'Ì' => '',
            'ğŸ‡»ğŸ‡³' => 'vn',
        ];
    }
}